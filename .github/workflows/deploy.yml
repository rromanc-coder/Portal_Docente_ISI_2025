name: ğŸš€ Deploy Portal Docente ISI 2025

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸ§© Despliegue del portal
    runs-on: self-hosted
    steps:
      - name: ğŸ§¾ Clonar cÃ³digo del repositorio
        uses: actions/checkout@v4

      - name: âš™ï¸ Sincronizar cambios con el contenedor local
        run: |
          echo "ğŸ“‚ Sincronizando repositorio en /srv/pln/proyecto_ISI..."
          cd /srv/pln/proyecto_ISI
          sudo git fetch origin main
          sudo git reset --hard origin/main

      - name: ğŸ³ Reconstruir y levantar contenedor
        run: |
          echo "ğŸš€ Construyendo e iniciando contenedores del portal..."
          cd /srv/pln/proyecto_ISI
          sudo docker compose down || true
          sudo docker compose up -d --build

      - name: âœ… Validar estado de los servicios
        run: |
          echo "ğŸ” Estado actual de contenedores:"
          sudo docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
