name: ğŸš€ Deploy Portal Docente ISI 2025

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: ğŸ§© Checkout del repositorio
        uses: actions/checkout@v4

      - name: ğŸ“‚ Sincronizando cÃ³digo con /srv/pln/proyecto_ISI
        run: |
          DEPLOY_PATH="/srv/pln/proyecto_ISI"
          echo "ğŸ“‚ Sincronizando cÃ³digo con $DEPLOY_PATH..."
          sudo rsync -av --delete \
            --exclude '.git' \
            --exclude '.github' \
            --exclude 'runner_portal' \
            --exclude 'app/frontend/node_modules' \
            ./ $DEPLOY_PATH/

          cd $DEPLOY_PATH
          echo "ğŸ§¹ Limpiando build previo..."
          sudo docker compose down || true
          sudo docker system prune -af || true

          echo "ğŸ” Reconstruyendo contenedores..."
          sudo docker compose up -d --build --force-recreate

          echo "âœ… Deploy completado exitosamente."

